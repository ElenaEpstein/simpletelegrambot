var token = "689601800:AAHfqCHuBcbw_fFqNXEvmGS04jSoyCZUirI"; // FILL IN YOUR OWN TOKEN
var telegramUrl = "https://api.telegram.org/bot" + token;
var webAppUrl = "https://script.google.com/macros/s/AKfycbzHr2dOuFxq4pOskbM6-WZsfWOipb50Ibxsr1qN9AAWTidLmD4B/exec"; // FILL IN YOUR GOOGLE WEB APP ADDRESS
var ssId = "17tZRxD3zI73sBaP50okJzduaruISQu89pq-xxjiwMWw"; // FILL IN THE ID OF YOUR SPREADSHEET

function getMe() {
  var url = telegramUrl + "/getMe";
  var response = UrlFetchApp.fetch(url);
  Logger.log(response.getContentText());
}

function setWebhook() {
  var url = telegramUrl + "/setWebhook?url=" + webAppUrl;
  var response = UrlFetchApp.fetch(url);
  Logger.log(response.getContentText());
}

function sendText(id,text) {
  var url = telegramUrl + "/sendMessage?chat_id=" + id + "&text=" + text;
  var response = UrlFetchApp.fetch(url);
  Logger.log(response.getContentText());
}



//–°–∫—Ä–∏–ø—Ç —á–∞—Ç–±–æ—Ç–∞

function doGet(e) {
  return HtmlService.createHtmlOutput("–ü—Ä–∏–≤–µ—Ç!");
}


function doPost(e) {
  //this is where telegram works
  var data = JSON.parse(e.postData.contents);
  var text = data.message.text;
  var id = data.message.chat.id;
  var name = data.message.chat.first_name + " " + data.message.chat.last_name;

  
  //–ü—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ
  if (/.*start/.test(text)) {
    var sheetName = "Welcome";
    var sheet = SpreadsheetApp.openById(ssId).getSheetByName(sheetName) ? SpreadsheetApp.openById(ssId).getSheetByName(sheetName) : SpreadsheetApp.openById(ssId).insertSheet(sheetName);
    var comment = text.split(" ").slice(1).join(" ");
    var answer = "–ü—Ä–∏–≤–µ—Ç, " + name + ", –Ω–∞—à –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ —Ä–µ–±—è—Ç–∞–º–∏. –ê —Ç—ã –ø–æ–∫–∞ –º–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å —Å–µ–±–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–ª–∞–≤–∏—à—É –≤ –º–µ–Ω—é –∏–ª–∏ –Ω–∞–ø–∏—Å–∞–≤ - –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞ –∏–ª–∏ –ù–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ. ";
    sheet.appendRow([new Date(),id,name,comment,answer]);
    sendText(id,answer); 
  }
  
  //–í—Å—Ç–∞–≤–ª—è—Ç—å –±–ª–æ–∫–∏ —Å —Ç–µ–∫—Å—Ç–æ–º –≤ –ø–æ–ª–µ answer –≤ –∫–∞–≤—ã—á–∫–∞—Ö
  if(/^–°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞/.test(text)) {
    var sheetName = text;
    var sheet = SpreadsheetApp.openById(ssId).getSheetByName(sheetName) ? SpreadsheetApp.openById(ssId).getSheetByName(sheetName) : SpreadsheetApp.openById(ssId).insertSheet(sheetName);
    var comment = text.split(" ").slice(1).join(" ");
    var answer = "–î–ª—è —Ç–µ–±—è –µ—Å—Ç—å –±–ª–∏–∂–∞–π—à–µ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –Ω–∞ 11 –∞–≤–≥—É—Å—Ç–∞ - –≠–∫–æ—Ñ–µ—Å—Ç–∏–≤–∞–ª—å Green Village! –§–µ—Å—Ç–∏–≤–∞–ª—å –æ–± —ç–∫–æ–ª–æ–≥–∏–∏, –º–Ω–æ–≥–æ–æ–±—Ä–∞–∑–∏–∏ –∫—É–ª—å—Ç—É—Ä –∏ –∑–¥–æ—Ä–æ–≤—å–µ.";
    sendText(id, answer);
    sheet.appendRow([new Date(),id,name,comment,answer]);
  }
  
//    if(/^–ó–∞–¥–∞—á–∞1/.test(text)) {
//    var sheetName = text;
//    var sheet = SpreadsheetApp.openById(ssId).getSheetByName(sheetName) ? SpreadsheetApp.openById(ssId).getSheetByName(sheetName) : SpreadsheetApp.openById(ssId).insertSheet(sheetName);
//    var comment = text.split(" ").slice(1).join(" ");
//    var answer = "–î–ª—è —Ç–µ–±—è –µ—Å—Ç—å –±–ª–∏–∂–∞–π—à–µ–µ –º–µ—Ä–æ–ø—Ä–∏—è—Ç–∏–µ –Ω–∞ 11 –∞–≤–≥—É—Å—Ç–∞ - –≠–∫–æ—Ñ–µ—Å—Ç–∏–≤–∞–ª—å Green Village! –§–µ—Å—Ç–∏–≤–∞–ª—å –æ–± —ç–∫–æ–ª–æ–≥–∏–∏, –º–Ω–æ–≥–æ–æ–±—Ä–∞–∑–∏–∏ –∫—É–ª—å—Ç—É—Ä –∏ –∑–¥–æ—Ä–æ–≤—å–µ.";
//    sendText(id, answer);
//    sheet.appendRow([new Date(),id,name,comment,answer]);
//  }
  if(/^–ù–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ/.test(text)) {
    var sheetName = text;
    var sheet = SpreadsheetApp.openById(ssId).getSheetByName(sheetName) ? SpreadsheetApp.openById(ssId).getSheetByName(sheetName) : SpreadsheetApp.openById(ssId).insertSheet(sheetName);
    var comment = text.split(" ").slice(1).join(" ");
    var answer = "–ù–∞ –ø—Ä–æ—à–ª–æ–π –Ω–µ–¥–µ–ª–µ –ø—Ä–æ—à–ª–∏ 2 –≤–∞–∂–Ω—ã–µ –≤—Å—Ç—Ä–µ—á–∏:–û–ª—å–≥–∞ –ì–∞—Å–∫–∞—Ä–æ–≤–∞ —Å –ù–∞—Å—Ç–µ–π –¥–æ–∫–ª–µ–∏–ª–∏ –æ–±–æ–∏, –ö–∞—Ä–∏–Ω–∞ –£—Å–æ–ª—å—Ü–µ–≤–∞ —Å  –°–µ—Ä–µ–∂–µ–π –ø—Ä–æ–≤–µ–ª–∏ –ø–µ—Ä–≤—É—é –≤—Å—Ç—Ä–µ—á—É –ø–æ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –±—é–¥–∂–µ—Ç–∞. –õ–æ–≤–∏ –±–∞–Ω–∫ –∑–∞–¥–∞—á –æ—Ç 18 –∏—é–ª—è.1) üí∞–ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ  –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏—é –±—é–¥–∂–µ—Ç–∞ üí∞–Æ—Ä–∏–π –î–∞–≤—ã–¥–æ–≤ 18 –ª–µ—Ç –ú–µ—Å—Ç—Ä–æ –≤—Å—Ç—Ä–µ—á–∏: –º. –ë–∞–ª—Ç–∏–π—Å–∫–∞—è 2) üè† –ö–æ–Ω—Å—É–ª—å—Ç–∞—Ü–∏—è –ø–æ —Å—ä–µ–º—É –∂–∏–ª—å—è üè† –ò–≥–æ—Ä—å –ö–∞–Ω–∞–π–∫–∏–Ω 18 –ª–µ—Ç –ú–µ—Å—Ç–æ  –≤—Å—Ç—Ä–µ—á–∏: –º. –ë–∞–ª—Ç–∏–π—Å–∫–∞—è"
    sendText(id,answer);
    sheet.appendRow([new Date(),id,name,comment,answer]);
  }
  
  if(/^–ù–∞–∑–∞–¥/.test(text)) {
    var answer = "–ü—Ä–∏–≤–µ—Ç, " + name + ", –Ω–∞—à –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–æ—Ä –≤–æ–ª–æ–Ω—Ç–µ—Ä–æ–≤ –Ω–∞ –¥–∞–Ω–Ω—ã–π –º–æ–º–µ–Ω—Ç –∑–Ω–∞–∫–æ–º–∏—Ç—Å—è —Å –Ω–æ–≤—ã–º–∏ —Ä–µ–±—è—Ç–∞–º–∏. –ê —Ç—ã –ø–æ–∫–∞ –º–æ–∂–µ—à—å –≤—ã–±—Ä–∞—Ç—å —Å–µ–±–µ –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É, –Ω–∞–∂–∞–≤ –Ω–∞ –∫–ª–∞–≤–∏—à—É –≤ –º–µ–Ω—é –∏–ª–∏ –Ω–∞–ø–∏—Å–∞–≤ - –°—Ç–∞–∂–∏—Ä–æ–≤–∫–∞ –∏–ª–∏ –ù–∞—Å—Ç–∞–≤–Ω–∏—á–µ—Å—Ç–≤–æ. ";
    return sendText(id,answer);
  }
  
  //–û—Ç–ø—Ä–∞–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –ø–æ email
   if (/^–î–∞/.test(text)) {
      GmailApp.sendEmail(Session.getEffectiveUser().getEmail(), "–°–ø–∞—Å–∏–±–æ, " + name + " –í–∞—à–∞ –∑–∞—è–≤–∫–∞ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∞", JSON.stringify(e,null,4));
}

}
